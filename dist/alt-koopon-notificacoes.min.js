!function(t){"use strict";t.module("alt.koopon.notificacoes",["emd.ng-xtorage"]).constant("ALT_KOOPON_CHAVE_NOTIFICACOES_MENSAGENS","alt_koopon_notificacoes_msg").service("AltKooponNotificacoesManager",["$xtorage","ALT_KOOPON_CHAVE_NOTIFICACOES_MENSAGENS",function(t,a){this.retorna=function(){return t.get(a)||{}},this.atualiza=function(i,o){var e=this.retorna();e[i]=o,t.save(a,e)},this.cria=function(i){t.save(a,i)},this.limpa=function(){t.remove(a)},this.temMensagemPraLer=function(){var t=this.retorna()||{},a=t.qtd||0,i=t.qtdUltimaReq||0,o=t.limpa;return i>a&&!o}}]).provider("AltKooponNotificacoesService",[function(){var t=this;t.BASE_API="/koopon-rest-api/",this.$get=["$http","$q",function(a,i){var o=function(){this.TEMPO_BUSCA=3e5,this.URL=t.BASE_API+"mensagens/count"};return o.prototype.buscar=function(){return a.get(this.URL).then(function(t){return t.data})["catch"](function(t){return i.reject(t.data)})},new o}]}]).controller("AltKooponNotificacoesController",["$rootScope","$location","$interval","AltKooponNotificacoesService","AltKooponNotificacoesManager",function(t,a,i,o,e){var c=this;c.exibeNotificacao=!1,c.qtdNotificacoes=0,c._idInterval=0,c._buscar=function(){o.buscar().then(function(t){if(c.qtdNotificacoes=t.qtd,"/mensagens"===a.path()||"/selecao-empresas"===a.path()){if(c.exibeNotificacao=!1,!e.retorna())return e.cria({qtd:0,qtdUltimaReq:0,limpa:!0});e.atualiza("limpa",!0),e.atualiza("qtd",c.qtdNotificacoes),e.atualiza("qtdUltimaReq",c.qtdNotificacoes)}return c.qtdNotificacoes?e.retorna()?(e.atualiza("qtdUltimaReq",c.qtdNotificacoes),e.atualiza("limpa",!1),void(e.temMensagemPraLer()?c.exibeNotificacao=!0:c.exibeNotificacao=!1)):(c.exibeNotificacao=!0,e.cria({qtd:c.qtdNotificacoes,qtdUltimaReq:0,limpa:!1})):(c.exibeNotificacao=!1,e.cria({qtd:0,qtdUltimaReq:0,limpa:!0}))})},function(){c._buscar(),c._idInterval=i(c._buscar,o.TEMPO_BUSCA),t.$on("$locationChangeSuccess",function(){c._buscar(),i.cancel(c._idInterval),c._idInterval=i(c._buscar,o.TEMPO_BUSCA)})}()}])}(angular);