!function(t){"use strict";t.module("alt.koopon.notificacoes",["emd.ng-xtorage"]).constant("ALT_KOOPON_CHAVE_NOTIFICACOES_MENSAGENS","alt_koopon_notificacoes_msg").service("AltKooponNotificacoesManager",["$xtorage","ALT_KOOPON_CHAVE_NOTIFICACOES_MENSAGENS",function(t,o){this.retorna=function(){return t.get(o)},this.atualiza=function(i,a){var e=this.retorna();e[i]=a,t.save(o,e)},this.cria=function(i){t.save(o,i)},this.limpa=function(){t.remove(o)},this.temMensagemPraLer=function(){var t=this.retorna()||{},o=t.qtd,i=t.qtdUltimaReq,a=t.limpa;return i>o&&!a}}]).provider("AltKooponNotificacoesService",[function(){var t=this;t.BASE_API="/koopon-rest-api/",this.$get=["$http","$q",function(o,i){var a=function(){this.TEMPO_BUSCA=3e5,this.URL=t.BASE_API+"mensagens/count"};return a.prototype.buscar=function(){return o.get(this.URL).then(function(t){return t.data})["catch"](function(t){return i.reject(t.data)})},new a}]}]).controller("AltKooponNotificacoesController",["$rootScope","$location","$interval","AltKooponNotificacoesService","AltKooponNotificacoesManager",function(t,o,i,a,e){var n=this;n.exibeNotificacao=!1,n.qtdNotificacoes=0,n._idInterval=0,n._buscar=function(){a.buscar().then(function(t){return"/mensagens"===o.path()?(n.exibeNotificacao=!1,e.atualiza("limpa",!0)):(n.qtdNotificacoes=t.qtd,n.qtdNotificacoes?e.retorna()?(e.atualiza("qtdUltimaReq",n.qtdNotificacoes),void(e.temMensagemPraLer()?n.exibeNotificacao=!0:n.exibeNotificacao=!1)):(n.exibeNotificacao=!0,e.cria({qtd:n.qtdNotificacoes,qtdUltimaReq:0,limpa:!1})):(n.exibeNotificacao=!1,e.cria({qtd:0,qtdUltimaReq:0,limpa:!0})))})},function(){n._buscar(),n._idInterval=i(n._buscar,a.TEMPO_BUSCA),t.$on("$locationChangeSuccess",function(){n._buscar(),i.cancel(n._idInterval),n._idInterval=i(n._buscar,a.TEMPO_BUSCA)})}()}])}(angular);