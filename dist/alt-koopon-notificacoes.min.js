!function(t){"use strict";t.module("alt.koopon.notificacoes",["emd.ng-xtorage"]).constant("ALT_KOOPON_CHAVE_NOTIFICACOES_MENSAGENS","alt_koopon_notificacoes_msg").service("AltKooponNotificacoesManager",["$xtorage","ALT_KOOPON_CHAVE_NOTIFICACOES_MENSAGENS",function(t,i){this.retorna=function(){return t.get(i)||{}},this.atualiza=function(a,o){var e=this.retorna();e[a]=o,t.save(i,e)},this.cria=function(a){t.save(i,a)},this.limpa=function(){t.remove(i)},this.temMensagemPraLer=function(){var t=this.retorna()||{},i=t.qtd||0,a=t.qtdUltimaReq||0,o=t.limpa;return a>i&&!o}}]).provider("AltKooponNotificacoesService",[function(){var t=this;t.BASE_API="/koopon-rest-api/",this.$get=["$http","$q",function(i,a){var o=function(){this.TEMPO_BUSCA=3e5,this.URL=t.BASE_API+"mensagens/count"};return o.prototype.buscar=function(){return i.get(this.URL).then(function(t){return t.data})["catch"](function(t){return a.reject(t.data)})},new o}]}]).controller("AltKooponNotificacoesController",["$rootScope","$location","$interval","AltKooponNotificacoesService","AltKooponNotificacoesManager",function(t,i,a,o,e){var n=this;n.exibeNotificacao=!1,n.qtdNotificacoes=0,n._idInterval=0,n._buscar=function(){o.buscar().then(function(t){if(n.qtdNotificacoes=t.qtd,"/mensagens"===i.path()){if(n.exibeNotificacao=!1,!e.retorna())return e.cria({qtd:0,qtdUltimaReq:0,limpa:!0});e.atualiza("limpa",!0),e.atualiza("qtd",n.qtdNotificacoes),e.atualiza("qtdUltimaReq",n.qtdNotificacoes)}return n.qtdNotificacoes?e.retorna()?(e.atualiza("qtdUltimaReq",n.qtdNotificacoes),e.atualiza("limpa",!1),void(e.temMensagemPraLer()?n.exibeNotificacao=!0:n.exibeNotificacao=!1)):(n.exibeNotificacao=!0,e.cria({qtd:n.qtdNotificacoes,qtdUltimaReq:0,limpa:!1})):(n.exibeNotificacao=!1,e.cria({qtd:0,qtdUltimaReq:0,limpa:!0}))})},function(){n._buscar(),n._idInterval=a(n._buscar,o.TEMPO_BUSCA),t.$on("$locationChangeSuccess",function(){n._buscar(),a.cancel(n._idInterval),n._idInterval=a(n._buscar,o.TEMPO_BUSCA)})}()}])}(angular);